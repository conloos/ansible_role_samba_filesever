---
- name: copy timesyncd.conf
  ansible.builtin.template:
    src: timesyncd.conf.j2
    dest: /etc/systemd/timesyncd.conf
    owner: root
    group: root
    mode: '0644'

# fix condition failed -> ConditionVirtualization=!container was not met and ConditionCapability=CAP_SYS_TIME was not met
- block:
  - name: fix ConditionVirtualization
    lineinfile:
      path: /lib/systemd/system/systemd-timesyncd.service
      regexp: '^ConditionVirtualization'
      line: '#ConditionVirtualization=!container'
      backrefs: yes

  - name: fix ConditionCapability
    lineinfile:
      path: /lib/systemd/system/systemd-timesyncd.service
      regexp: '^ConditionCapability'
      line: '#ConditionCapability=CAP_SYS_TIME'
      backrefs: yes

- name: Populate service facts
  service_facts:

- name: Make sure timesyncd is started
  ansible.builtin.systemd:
    name: '{{ item }}'
    state: restarted
    enabled: yes
    masked: no
    daemon_reload: yes
  with_items:
    - systemd-timesyncd
...